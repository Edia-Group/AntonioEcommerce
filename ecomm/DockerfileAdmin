FROM node:18-alpine

WORKDIR /ecomm

COPY package.json yarn.lock ./
RUN yarn install --frozen-lockfile

# Create .env file for build configuration
RUN echo "PUBLIC_URL=." > .env

COPY . .
RUN yarn build:admin:deployment

EXPOSE 7001

RUN yarn global add serve

# Configure serve for proper static file handling
CMD ["serve", "-s", "build", "-l", "7001", "--single", "--cors", "--no-clipboard", "--trailing-slash"]